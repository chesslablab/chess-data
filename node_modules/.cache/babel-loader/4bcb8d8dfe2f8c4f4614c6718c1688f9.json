{"ast":null,"code":"import _filter from \"lodash/filter\";\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nimport raf, { cancel as caf } from 'raf';\nimport { getIntersectionKeys, mapObject } from './util';\n\nvar alpha = function alpha(begin, end, k) {\n  return begin + (end - begin) * k;\n};\n\nvar needContinue = function needContinue(_ref) {\n  var from = _ref.from,\n      to = _ref.to;\n  return from !== to;\n};\n/*\n * @description: cal new from value and velocity in each stepper\n * @return: { [styleProperty]: { from, to, velocity } }\n */\n\n\nvar calStepperVals = function calStepperVals(easing, preVals, steps) {\n  var nextStepVals = mapObject(function (key, val) {\n    if (needContinue(val)) {\n      var _easing = easing(val.from, val.to, val.velocity),\n          _easing2 = _slicedToArray(_easing, 2),\n          newX = _easing2[0],\n          newV = _easing2[1];\n\n      return _objectSpread({}, val, {\n        from: newX,\n        velocity: newV\n      });\n    }\n\n    return val;\n  }, preVals);\n\n  if (steps < 1) {\n    return mapObject(function (key, val) {\n      if (needContinue(val)) {\n        return _objectSpread({}, val, {\n          velocity: alpha(val.velocity, nextStepVals[key].velocity, steps),\n          from: alpha(val.from, nextStepVals[key].from, steps)\n        });\n      }\n\n      return val;\n    }, preVals);\n  }\n\n  return calStepperVals(easing, nextStepVals, steps - 1);\n}; // configure update function\n\n\nexport default (function (from, to, easing, duration, render) {\n  var interKeys = getIntersectionKeys(from, to);\n  var timingStyle = interKeys.reduce(function (res, key) {\n    return _objectSpread({}, res, _defineProperty({}, key, [from[key], to[key]]));\n  }, {});\n  var stepperStyle = interKeys.reduce(function (res, key) {\n    return _objectSpread({}, res, _defineProperty({}, key, {\n      from: from[key],\n      velocity: 0,\n      to: to[key]\n    }));\n  }, {});\n  var cafId = -1;\n  var preTime;\n  var beginTime;\n\n  var update = function update() {\n    return null;\n  };\n\n  var getCurrStyle = function getCurrStyle() {\n    return mapObject(function (key, val) {\n      return val.from;\n    }, stepperStyle);\n  };\n\n  var shouldStopAnimation = function shouldStopAnimation() {\n    return !_filter(stepperStyle, needContinue).length;\n  }; // stepper timing function like spring\n\n\n  var stepperUpdate = function stepperUpdate(now) {\n    if (!preTime) {\n      preTime = now;\n    }\n\n    var deltaTime = now - preTime;\n    var steps = deltaTime / easing.dt;\n    stepperStyle = calStepperVals(easing, stepperStyle, steps); // get union set and add compatible prefix\n\n    render(_objectSpread({}, from, to, getCurrStyle(stepperStyle)));\n    preTime = now;\n\n    if (!shouldStopAnimation()) {\n      cafId = raf(update);\n    }\n  }; // t => val timing function like cubic-bezier\n\n\n  var timingUpdate = function timingUpdate(now) {\n    if (!beginTime) {\n      beginTime = now;\n    }\n\n    var t = (now - beginTime) / duration;\n    var currStyle = mapObject(function (key, val) {\n      return alpha.apply(void 0, _toConsumableArray(val).concat([easing(t)]));\n    }, timingStyle); // get union set and add compatible prefix\n\n    render(_objectSpread({}, from, to, currStyle));\n\n    if (t < 1) {\n      cafId = raf(update);\n    } else {\n      var finalStyle = mapObject(function (key, val) {\n        return alpha.apply(void 0, _toConsumableArray(val).concat([easing(1)]));\n      }, timingStyle);\n      render(_objectSpread({}, from, to, finalStyle));\n    }\n  };\n\n  update = easing.isStepper ? stepperUpdate : timingUpdate; // return start animation method\n\n  return function () {\n    raf(update); // return stop animation method\n\n    return function () {\n      caf(cafId);\n    };\n  };\n});","map":{"version":3,"sources":["/usr/share/pgn-chess/node_modules/react-smooth/es6/configUpdate.js"],"names":["_filter","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","Object","prototype","toString","call","Array","from","isArray","i","arr2","length","_objectSpread","target","arguments","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_arr","_n","_d","_e","undefined","_i","_s","next","done","push","err","raf","cancel","caf","getIntersectionKeys","mapObject","alpha","begin","end","k","needContinue","_ref","to","calStepperVals","easing","preVals","steps","nextStepVals","val","_easing","velocity","_easing2","newX","newV","duration","render","interKeys","timingStyle","reduce","res","stepperStyle","cafId","preTime","beginTime","update","getCurrStyle","shouldStopAnimation","stepperUpdate","now","deltaTime","dt","timingUpdate","t","currStyle","apply","finalStyle","isStepper"],"mappings":"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","sourcesContent":["import _filter from \"lodash/filter\";\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport raf, { cancel as caf } from 'raf';\nimport { getIntersectionKeys, mapObject } from './util';\n\nvar alpha = function alpha(begin, end, k) {\n  return begin + (end - begin) * k;\n};\n\nvar needContinue = function needContinue(_ref) {\n  var from = _ref.from,\n      to = _ref.to;\n  return from !== to;\n};\n/*\n * @description: cal new from value and velocity in each stepper\n * @return: { [styleProperty]: { from, to, velocity } }\n */\n\n\nvar calStepperVals = function calStepperVals(easing, preVals, steps) {\n  var nextStepVals = mapObject(function (key, val) {\n    if (needContinue(val)) {\n      var _easing = easing(val.from, val.to, val.velocity),\n          _easing2 = _slicedToArray(_easing, 2),\n          newX = _easing2[0],\n          newV = _easing2[1];\n\n      return _objectSpread({}, val, {\n        from: newX,\n        velocity: newV\n      });\n    }\n\n    return val;\n  }, preVals);\n\n  if (steps < 1) {\n    return mapObject(function (key, val) {\n      if (needContinue(val)) {\n        return _objectSpread({}, val, {\n          velocity: alpha(val.velocity, nextStepVals[key].velocity, steps),\n          from: alpha(val.from, nextStepVals[key].from, steps)\n        });\n      }\n\n      return val;\n    }, preVals);\n  }\n\n  return calStepperVals(easing, nextStepVals, steps - 1);\n}; // configure update function\n\n\nexport default (function (from, to, easing, duration, render) {\n  var interKeys = getIntersectionKeys(from, to);\n  var timingStyle = interKeys.reduce(function (res, key) {\n    return _objectSpread({}, res, _defineProperty({}, key, [from[key], to[key]]));\n  }, {});\n  var stepperStyle = interKeys.reduce(function (res, key) {\n    return _objectSpread({}, res, _defineProperty({}, key, {\n      from: from[key],\n      velocity: 0,\n      to: to[key]\n    }));\n  }, {});\n  var cafId = -1;\n  var preTime;\n  var beginTime;\n\n  var update = function update() {\n    return null;\n  };\n\n  var getCurrStyle = function getCurrStyle() {\n    return mapObject(function (key, val) {\n      return val.from;\n    }, stepperStyle);\n  };\n\n  var shouldStopAnimation = function shouldStopAnimation() {\n    return !_filter(stepperStyle, needContinue).length;\n  }; // stepper timing function like spring\n\n\n  var stepperUpdate = function stepperUpdate(now) {\n    if (!preTime) {\n      preTime = now;\n    }\n\n    var deltaTime = now - preTime;\n    var steps = deltaTime / easing.dt;\n    stepperStyle = calStepperVals(easing, stepperStyle, steps); // get union set and add compatible prefix\n\n    render(_objectSpread({}, from, to, getCurrStyle(stepperStyle)));\n    preTime = now;\n\n    if (!shouldStopAnimation()) {\n      cafId = raf(update);\n    }\n  }; // t => val timing function like cubic-bezier\n\n\n  var timingUpdate = function timingUpdate(now) {\n    if (!beginTime) {\n      beginTime = now;\n    }\n\n    var t = (now - beginTime) / duration;\n    var currStyle = mapObject(function (key, val) {\n      return alpha.apply(void 0, _toConsumableArray(val).concat([easing(t)]));\n    }, timingStyle); // get union set and add compatible prefix\n\n    render(_objectSpread({}, from, to, currStyle));\n\n    if (t < 1) {\n      cafId = raf(update);\n    } else {\n      var finalStyle = mapObject(function (key, val) {\n        return alpha.apply(void 0, _toConsumableArray(val).concat([easing(1)]));\n      }, timingStyle);\n      render(_objectSpread({}, from, to, finalStyle));\n    }\n  };\n\n  update = easing.isStepper ? stepperUpdate : timingUpdate; // return start animation method\n\n  return function () {\n    raf(update); // return stop animation method\n\n    return function () {\n      caf(cafId);\n    };\n  };\n});"]},"metadata":{},"sourceType":"module"}